---
title: "Event Study: Analysis of Abnormal returns on green bond announcements by US Corporates from 2018-2022"
output: html_document
date: "2025-02-12"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


1.LOADING PACKAGES:
```{r}
required_packages <- c("tidyverse", "readxl", "ggplot2", "lmtest", "sandwich", "car", "boot")
new_packages <- required_packages[!(required_packages %in% installed.packages()[,"Package"])]
if(length(new_packages)) install.packages(new_packages)

library(tidyverse)
library(readxl)
library(ggplot2)
library(lmtest)
library(sandwich)
library(car)
library(boot)
```

2.READ FILES:
```{r}
# Define file paths
events_path <- "C:/Users/DELL/Downloads/1. Events_in_ET Kopie.xlsx"
index_path <- "C:/Users/DELL/Downloads/2. Index_Data_in_ET Kopie.xlsx"
stock_path <- "C:/Users/DELL/Downloads/3. Stock_Data_in_ET Kopie.xlsx"
regression_path <- "C:/Users/DELL/Downloads/4. Regression_Data Kopie.xlsx"

# Read Regression Data (Industry, Total Assets, Market Value)
industry_data <- read_excel(regression_path, sheet = 1, col_names = FALSE) %>%
  rename(ISIN = "...1", Industry = "...2")

total_assets_data <- read_excel(regression_path, sheet = 2, col_names = FALSE) %>%
  rename(ISIN = "...1", `Total Assets` = "...2")

market_value_data <- read_excel(regression_path, sheet = 3, col_names = FALSE) %>%
  rename(ISIN = "...1", `Market Value` = "...2")

# Merge Regression Data
regression_data <- industry_data %>%
  left_join(total_assets_data, by = "ISIN") %>%
  left_join(market_value_data, by = "ISIN")
```

3.CLEAN AND PREPARE THE DATA:
```{r}
events <- read_excel(events_path) %>%
  select(`Unternehmens ISIN`, `Bond ISIN`, `Announc. in ET`, `ESG Bond Type`, `Issued Amount (USD)`, `Yield`, `Maturity Date`, `Issue Date`) %>%
  mutate(
    `Announc. in ET` = as.numeric(`Announc. in ET`),
    `Unternehmens ISIN` = trimws(`Unternehmens ISIN`)
  ) %>%
  drop_na(`Unternehmens ISIN`, `Announc. in ET`) %>%
  arrange(`Unternehmens ISIN`, `Bond ISIN`, `Announc. in ET`)

library(zoo)  

index_data <- read_excel(index_path) %>%
  select(Eventtime, `IndexS&P500`) %>%
  mutate(
    Eventtime = as.numeric(Eventtime),
    `IndexS&P500` = as.numeric(`IndexS&P500`)
  ) %>%
  arrange(Eventtime) %>%
  mutate(Market_Returns = log(`IndexS&P500` / lag(`IndexS&P500`))) %>%
  mutate(Market_Returns = na.locf(Market_Returns, na.rm = FALSE)) %>%  # Forward fill missing values
  mutate(Market_Returns = ifelse(is.na(Market_Returns), 0, Market_Returns))
```

4.CALCULATE LOG RETURNS:
```{r}

stock_prices <- read_excel(stock_path) %>%
  mutate(`Isin/Eventtime` = as.numeric(`Isin/Eventtime`))

# Filter only relevant Unternehmens ISINs:
event_isins <- events %>% pull(`Unternehmens ISIN`) %>% unique()
valid_isins <- intersect(event_isins, colnames(stock_prices))

stock_returns <- stock_prices %>%
  select("Isin/Eventtime", all_of(valid_isins)) %>%
  pivot_longer(cols = -`Isin/Eventtime`, names_to = "ISIN", values_to = "Price") %>%
  mutate(
    Price = as.numeric(Price),
    Returns = log(Price / lag(Price))
  ) %>%
  drop_na() %>%
  arrange(ISIN, `Isin/Eventtime`) 
```

5.ESTIMATION WINDOW (-220 to -20) & MARKET MODEL:

The estimation window spans 200 trading days (-220 to -20) prior to each event.A linear regression is performed for each firm to estimate alpha and beta values.
```{r}
# Read stock prices and convert event time to numeric
stock_prices <- read_excel(stock_path) %>%
  mutate(`Isin/Eventtime` = as.numeric(`Isin/Eventtime`))

# Filter only relevant Unternehmens ISINs
event_isins <- events %>% pull(`Unternehmens ISIN`) %>% unique()
valid_isins <- intersect(event_isins, colnames(stock_prices))

# Process stock returns
stock_returns <- stock_prices %>%
  select("Isin/Eventtime", all_of(valid_isins)) %>%
  pivot_longer(cols = -`Isin/Eventtime`, names_to = "ISIN", values_to = "Price") %>%
  mutate(
    Price = as.numeric(Price),
    Returns = log(Price / lag(Price))
  ) %>%
  drop_na() %>%
  arrange(ISIN, `Isin/Eventtime`) 

# ESTIMATION WINDOW (-220 to -20) & MARKET MODEL
suppressWarnings({
  estimation_data <- stock_returns %>%
    inner_join(events, by = c("ISIN" = "Unternehmens ISIN")) %>%
    rename(`Unternehmens ISIN` = ISIN) %>%  
    filter(`Isin/Eventtime` >= (`Announc. in ET` - 220) & `Isin/Eventtime` <= (`Announc. in ET` - 20)) %>%
    left_join(index_data, by = c("Isin/Eventtime" = "Eventtime")) %>%
    select(`Unternehmens ISIN`, `Bond ISIN`, `Announc. in ET`, everything()) %>%  
    arrange(`Unternehmens ISIN`, `Bond ISIN`, `Announc. in ET`, `Isin/Eventtime`)
})

# Estimating market model parameters
market_model_params <- estimation_data %>%
  group_by(`Unternehmens ISIN`) %>%
  summarise(
    alpha = coef(lm(Returns ~ Market_Returns, data = pick(everything())))[1],
    beta = coef(lm(Returns ~ Market_Returns, data = pick(everything())))[2],
    .groups = "drop"
  ) %>%
  rename(ISIN = `Unternehmens ISIN`)




```

6.CALCULATE ABNORMAL RETURNS & CAR:

Abnormal Return (AR) is computed as the difference between actual stock returns and expected returns.

Cumulative Abnormal Returns (CARs) are then computed for three event windows:
(-10, -4): Pre-announcement period
(-3, 3): Event window (Main Focus)
(4, 10): Post-announcement period
Summing ARs over these time windows helps assess how stock prices respond to green bond issuance announcements.
```{r}
#ar

event_stock_data <- stock_returns %>%
  inner_join(events, by = c("ISIN" = "Unternehmens ISIN"), relationship = "many-to-many") %>%
  left_join(market_model_params, by = "ISIN") %>%
  left_join(index_data, by = c("Isin/Eventtime" = "Eventtime")) %>%
  mutate(
    Expected_Return = alpha + beta * Market_Returns,
    Abnormal_Return = Returns - Expected_Return
  ) %>%
  rename(`Unternehmens ISIN` = ISIN) %>%
  arrange(`Unternehmens ISIN`, `Bond ISIN`, `Announc. in ET`, `Isin/Eventtime`)


#car

CAR_data <- event_stock_data %>%
  filter(`Isin/Eventtime` >= (`Announc. in ET` - 10) & `Isin/Eventtime` <= (`Announc. in ET` + 10)) %>%
  group_by(`Unternehmens ISIN`, `Bond ISIN`, `Announc. in ET`) %>%
  summarise(
    CAR_Pre = sum(Abnormal_Return[(`Isin/Eventtime` >= (`Announc. in ET` - 10)) & (`Isin/Eventtime` <= (`Announc. in ET` - 4))], na.rm = TRUE),
    CAR_Event = sum(Abnormal_Return[(`Isin/Eventtime` >= (`Announc. in ET` - 3)) & (`Isin/Eventtime` <= (`Announc. in ET` + 3))], na.rm = TRUE),
    CAR_Post = sum(Abnormal_Return[(`Isin/Eventtime` >= (`Announc. in ET` + 4)) & (`Isin/Eventtime` <= (`Announc. in ET` + 10))], na.rm = TRUE),
    .groups = "drop"
  )
print(CAR_data)
```

7.T-TESTS FOR SIGNIFICANCE TESTING:

To determine whether the CARs are statistically different from zero, t-tests are performed:

i. Null Hypothesis (H0=The mean CAR is zero, meaning no significant impact from the announcement.
ii.Alternative Hypothesis (H1:The mean CAR is non-zero, indicating a significant stock price reaction.

Tests are conducted at 1%, 5%, and 10% significance levels.

```{r}

run_t_test <- function(data, window_name, significance_level) {
  test <- t.test(data, mu = 0, conf.level = significance_level)
  
  # Determine significance level with stars
  sig_stars <- ifelse(test$p.value < 0.01, "***",
                      ifelse(test$p.value < 0.05, "**",
                             ifelse(test$p.value < 0.10, "*", "n.s.")))  # "n.s." = not significant
  
  result <- data.frame(
    Window = window_name,
    Mean = mean(data, na.rm = TRUE),
    Std_Dev = sd(data, na.rm = TRUE),
    t_statistic = test$statistic,
    p_value = test$p.value,
    Significance = sig_stars,
    Significance_Level = paste0((1 - significance_level) * 100, "%"),
    stringsAsFactors = FALSE  # Prevents unwanted row names
  )
  
  return(result)
}

# Run t-tests separately for each event window at different significance levels
t_test_10 <- bind_rows(
  run_t_test(CAR_data$CAR_Pre, "CAR_Pre", 0.90),
  run_t_test(CAR_data$CAR_Event, "CAR_Event", 0.90),
  run_t_test(CAR_data$CAR_Post, "CAR_Post", 0.90)
)

t_test_5 <- bind_rows(
  run_t_test(CAR_data$CAR_Pre, "CAR_Pre", 0.95),
  run_t_test(CAR_data$CAR_Event, "CAR_Event", 0.95),
  run_t_test(CAR_data$CAR_Post, "CAR_Post", 0.95)
)

t_test_1 <- bind_rows(
  run_t_test(CAR_data$CAR_Pre, "CAR_Pre", 0.99),
  run_t_test(CAR_data$CAR_Event, "CAR_Event", 0.99),
  run_t_test(CAR_data$CAR_Post, "CAR_Post", 0.99)
)

# Print each table separately for different significance levels
cat("\n T-Test Results at 10% Significance Level:\n")
print(t_test_10, row.names = FALSE)

cat("\n T-Test Results at 5% Significance Level:\n")
print(t_test_5, row.names = FALSE)

cat("\n T-Test Results at 1% Significance Level:\n")
print(t_test_1, row.names = FALSE)
```

8.INDUSTRY-LEVEL ANALYSIS:
To examine whether different industries exhibit distinct reactions to green bond announcements.

Methodology:
The CARs for each industry is computed separately to examine sector-wide responses to green bond issuance.
T-tests are conducted to check whether industries react significantly to green bond announcements.
Industries are categorized as significantly affected or not affected, based on p-values.
```{r}

# Merge Industry Data into CAR_data
CAR_data_industry <- CAR_data %>%
  left_join(regression_data, by = c("Unternehmens ISIN" = "ISIN")) %>%
  drop_na(Industry)  # Ensure no missing industry values

# Compute Industry-Level Statistics:
industry_results <- CAR_data_industry %>%
  group_by(Industry) %>%
  summarise(
    Num_Bond_Issues = n(),  
    Mean_CAR = mean(CAR_Event, na.rm = TRUE),  
    Std_Dev = sd(CAR_Event, na.rm = TRUE),  
    
    #Run t-test only if at least 2 bond issues exist in the industry:
    t_statistic = ifelse(Num_Bond_Issues >= 2, t.test(CAR_Event)$statistic, NA),
    p_value = ifelse(Num_Bond_Issues >= 2, t.test(CAR_Event)$p.value, NA),
    
    .groups = "drop"
  )


# Function to categorize significance levels separately
apply_significance <- function(df, level) {
  df %>%
    mutate(
      Significance_Level = paste0(level, "%"),
      Significant = case_when(
        p_value <= level / 100 ~ "Yes",
        TRUE ~ "No"
      )
    ) %>%
    select(Industry, Num_Bond_Issues, Mean_CAR, Std_Dev, t_statistic, p_value, Significance_Level, Significant)
}

# Create separate tables for each significance level
industry_results_10 <- apply_significance(industry_results, 10)
industry_results_5  <- apply_significance(industry_results, 5)
industry_results_1  <- apply_significance(industry_results, 1)


print(" Industry-Level Analysis of CAR (-3,3) with T-Test Results at 10% Significance Level:")
print(industry_results_10)

print(" Industry-Level Analysis of CAR (-3,3) with T-Test Results at 5% Significance Level:")
print(industry_results_5)

print(" Industry-Level Analysis of CAR (-3,3) with T-Test Results at 1% Significance Level:")
print(industry_results_1)
```

9.ELECTION ANALYSIS:
To assess whether green bond announcements had different market reactions before and after the 2020 US Presidential Election (November 3, 2020, ET = 1003).
The sample is divided into pre-election (ET ≤ 1002) and post-election (ET ≥ 1004) periods.
CARs is computed separately for each period and tested using a t-test.
```{r}

# STEP 1: SPLIT DATA INTO PRE & POST-ELECTION PERIODS

CAR_data_election <- CAR_data %>%
  mutate(
    Election_Period = case_when(
      `Announc. in ET` <= 1002 ~ "Before Election",
      `Announc. in ET` >= 1004 ~ "After Election",
      TRUE ~ NA_character_  # Exclude ET = 1003 as it's the election day
    )
  ) %>%
  drop_na(Election_Period)


# STEP 2: COMPUTE STATISTICS FOR BOTH PERIODS


election_results <- CAR_data_election %>%
  group_by(Election_Period) %>%
  summarise(
    CAAR = mean(CAR_Event, na.rm = TRUE), 
    Std_Dev = sd(CAR_Event, na.rm = TRUE),  
    
    # Run t-test (if more than 2 observations exist)
    t_statistic = ifelse(n() >= 2, t.test(CAR_Event)$statistic, NA),
    p_value = ifelse(n() >= 2, t.test(CAR_Event)$p.value, NA),
    
    .groups = "drop"
  )


apply_significance_election <- function(df, level) {
  df %>%
    mutate(
      Significance_Level = paste0(level, "%"),
      Significant = case_when(
        p_value <= level / 100 ~ "Yes",
        TRUE ~ "No"
      )
    ) %>%
    select(Election_Period, CAAR, Std_Dev, t_statistic, p_value, Significance_Level, Significant)
}

# Create separate tables for each significance level
election_results_10 <- apply_significance_election(election_results, 10)
election_results_5  <- apply_significance_election(election_results, 5)
election_results_1  <- apply_significance_election(election_results, 1)



print("Election Period Analysis: T-Test Results at 10% Significance Level:")
print(election_results_10)

print("Election Period Analysis: T-Test Results at 5% Significance Level:")
print(election_results_5)

print("Election Period Analysis: T-Test Results at 1% Significance Level:")
print(election_results_1)

```

10.ROBUSTNESS CHECK:
Objective:
To ensure the reliability of our findings by testing alternative methodologies.

Robustness Test 1: Excluding Financial Firms:
Financial firms is excluded from the sample to check whether their inclusion biases the results.

Robustness Test 2: Using Median CAR Instead of Mean
Since mean CARs can be influenced by extreme outliers, median CARs is computed instead.
```{r}
# STEP 1: EXCLUDING FINANCIALS INDUSTRY

# Merge Industry data and filter out Financials
CAR_data_no_finance <- CAR_data %>%
  left_join(regression_data, by = c("Unternehmens ISIN" = "ISIN")) %>%
  drop_na(Industry) %>%
  filter(Industry != "Financials")  

# Compute CAAR (Cumulative Average Abnormal Returns) after excluding Financials
CAAR_no_finance <- CAR_data_no_finance %>%
  summarise(
    CAAR_Pre = mean(CAR_Pre, na.rm = TRUE),
    CAAR_Event = mean(CAR_Event, na.rm = TRUE),
    CAAR_Post = mean(CAR_Post, na.rm = TRUE),
    Std_Dev_Pre = sd(CAR_Pre, na.rm = TRUE),
    Std_Dev_Event = sd(CAR_Event, na.rm = TRUE),
    Std_Dev_Post = sd(CAR_Post, na.rm = TRUE)
  )

# Conduct t-tests at different significance levels
run_t_test <- function(data, window_name, significance_level) {
  test <- t.test(data, mu = 0, conf.level = significance_level)
  
  # Determine significance level with stars
  sig_stars <- ifelse(test$p.value < 0.01, "***",
                      ifelse(test$p.value < 0.05, "**",
                             ifelse(test$p.value < 0.10, "*", "n.s.")))  # "n.s." = not significant
  
  result <- data.frame(
    Window = window_name,
    Mean = mean(data, na.rm = TRUE),
    Std_Dev = sd(data, na.rm = TRUE),
    t_statistic = test$statistic,
    p_value = test$p.value,
    Significance = sig_stars,
    Significance_Level = paste0((1 - significance_level) * 100, "%"),
    stringsAsFactors = FALSE  # Prevents unwanted row names
  )
  
  return(result)
}

# Run t-tests separately for each event window at different significance levels
t_test_10 <- bind_rows(
  run_t_test(CAR_data_no_finance$CAR_Pre, "CAR_Pre", 0.90),
  run_t_test(CAR_data_no_finance$CAR_Event, "CAR_Event", 0.90),
  run_t_test(CAR_data_no_finance$CAR_Post, "CAR_Post", 0.90)
)

t_test_5 <- bind_rows(
  run_t_test(CAR_data_no_finance$CAR_Pre, "CAR_Pre", 0.95),
  run_t_test(CAR_data_no_finance$CAR_Event, "CAR_Event", 0.95),
  run_t_test(CAR_data_no_finance$CAR_Post, "CAR_Post", 0.95)
)

t_test_1 <- bind_rows(
  run_t_test(CAR_data_no_finance$CAR_Pre, "CAR_Pre", 0.99),
  run_t_test(CAR_data_no_finance$CAR_Event, "CAR_Event", 0.99),
  run_t_test(CAR_data_no_finance$CAR_Post, "CAR_Post", 0.99)
)

# Print each table separately for different significance levels
cat("\nT-Test Results at 10% Significance Level:\n")
print(t_test_10, row.names = FALSE)

cat("\nT-Test Results at 5% Significance Level:\n")
print(t_test_5, row.names = FALSE)

cat("\nT-Test Results at 1% Significance Level:\n")
print(t_test_1, row.names = FALSE)


# STEP 2: USING MEDIAN FOR CAAR

# Compute CAAR using median instead of mean
CAAR_median <- CAR_data %>%
  summarise(
    CAAR_Pre = median(CAR_Pre, na.rm = TRUE),
    CAAR_Event = median(CAR_Event, na.rm = TRUE),
    CAAR_Post = median(CAR_Post, na.rm = TRUE),
    Std_Dev_Pre = sd(CAR_Pre, na.rm = TRUE),
    Std_Dev_Event = sd(CAR_Event, na.rm = TRUE),
    Std_Dev_Post = sd(CAR_Post, na.rm = TRUE)
  )

# Function to run t-tests at different significance levels
run_t_test_median <- function(data, window_name, significance_level) {
  test <- t.test(data, mu = 0, conf.level = significance_level)
  
  # Determine significance level with stars
  sig_stars <- ifelse(test$p.value < 0.01, "***",
                      ifelse(test$p.value < 0.05, "**",
                             ifelse(test$p.value < 0.10, "*", "n.s.")))  # "n.s." = not significant
  
  result <- data.frame(
    Window = window_name,
    Median = median(data, na.rm = TRUE),
    Std_Dev = sd(data, na.rm = TRUE),
    t_statistic = test$statistic,
    p_value = test$p.value,
    Significance = sig_stars,
    Significance_Level = paste0((1 - significance_level) * 100, "%"),
    stringsAsFactors = FALSE  # Prevents unwanted row names
  )
  
  return(result)
}

# Run t-tests separately for each event window at different significance levels
t_test_median_10 <- bind_rows(
  run_t_test_median(CAR_data$CAR_Pre, "CAR_Pre", 0.90),
  run_t_test_median(CAR_data$CAR_Event, "CAR_Event", 0.90),
  run_t_test_median(CAR_data$CAR_Post, "CAR_Post", 0.90)
)

t_test_median_5 <- bind_rows(
  run_t_test_median(CAR_data$CAR_Pre, "CAR_Pre", 0.95),
  run_t_test_median(CAR_data$CAR_Event, "CAR_Event", 0.95),
  run_t_test_median(CAR_data$CAR_Post, "CAR_Post", 0.95)
)

t_test_median_1 <- bind_rows(
  run_t_test_median(CAR_data$CAR_Pre, "CAR_Pre", 0.99),
  run_t_test_median(CAR_data$CAR_Event, "CAR_Event", 0.99),
  run_t_test_median(CAR_data$CAR_Post, "CAR_Post", 0.99)
)

# Print each table separately for different significance levels
cat("\nT-Test Results (Median-Based) at 10% Significance Level:\n")
print(t_test_median_10, row.names = FALSE)

cat("\nT-Test Results (Median-Based) at 5% Significance Level:\n")
print(t_test_median_5, row.names = FALSE)

cat("\nT-Test Results (Median-Based) at 1% Significance Level:\n")
print(t_test_median_1, row.names = FALSE)


```








11. REGRESSION ANALYSIS:


A regression model is constructed to examine the factors influencing cumulative abnormal returns (CAR) around green bond announcements. The dependent variable is CAR (-3,3), and the independent variables include:  

Green Bond Certification: Dummy variable (1 = Certified, 0 = Not Certified).  
Bond Size: Log of the issued amount.  
Yield: Interest rate of the bond.  
Maturity: Time until bond expiration (in years).  
Market Value: Log of the firm’s total market value.  
Election Period Dummy: Whether the bond issuance occurred before or after elections.  

The model is first estimated with all variables, including Log Total Assets; however, this introduces multicollinearity, as indicated by high Variance Inflation Factor (VIF) values. To enhance model stability, the regression is rerun without Log Total Assets, resulting in a more interpretable model. The Breusch-Pagan test for heteroskedasticity is performed, and it shows no significant heteroskedasticity issues. Therefore, regular standard errors are applied. The final model provides valuable insights into how firm and bond characteristics influence abnormal returns.


11.1 Regression:
```{r}

# Merge CAR data with Regression Data
CAR_regression_data <- CAR_data %>%
  left_join(events, by = c("Unternehmens ISIN", "Bond ISIN", "Announc. in ET")) %>%
  left_join(regression_data, by = c("Unternehmens ISIN" = "ISIN")) %>%
  drop_na(`Total Assets`, `Market Value`)  

# Convert "Total Assets" to numeric (handle commas and non-numeric values)
CAR_regression_data <- CAR_regression_data %>%
  mutate(
    `Total Assets` = as.numeric(gsub(",", "", `Total Assets`)),  # Remove commas
    Log_Total_Assets = ifelse(!is.na(`Total Assets`) & `Total Assets` > 0, log(`Total Assets`), NA)
  )

# Creating Election Dummy (1 = After Election, 0 = Before Election):
CAR_regression_data <- CAR_regression_data %>%
  mutate(Election_Dummy = ifelse(`Announc. in ET` > 1003, 1, 0))

# Converting "ESG Bond Type" into a binary variable (1 = Certified, 0 = Not Certified):
CAR_regression_data <- CAR_regression_data %>%
  mutate(
    `ESG Bond Type` = trimws(`ESG Bond Type`),  
    `ESG Bond Type` = tolower(`ESG Bond Type`),  
    Certification_Dummy = ifelse(`ESG Bond Type` == "cbi aligned green bond", 1, 0)  
  )

# Compute Bond Maturity (Maturity Date - Issue Date) in years:
CAR_regression_data <- CAR_regression_data %>%
  mutate(Maturity_Years = as.numeric(difftime(`Maturity Date`, `Issue Date`, units = "days")) / 365)

# Apply log transformation for other variables:
CAR_regression_data <- CAR_regression_data %>%
  mutate(
    Log_Issued_Amount = log(`Issued Amount (USD)`),
    Log_Market_Value = log(`Market Value`)
  )

# Define the formula for regression with Log_Total_Assets
regression_formula_with_assets <- CAR_Event ~ Certification_Dummy + Log_Issued_Amount + Yield +
  Maturity_Years + Log_Market_Value + Log_Total_Assets + Election_Dummy

# Run regression with Log_Total_Assets
regression_results_with_assets <- lm(regression_formula_with_assets, data = CAR_regression_data)

# Print the regression results
cat("Regression Results with Log_Total_Assets:\n")
print(summary(regression_results_with_assets))

# Check for multicollinearity (VIF) for the regression with Log_Total_Assets
cat("\nVIF Values for Model with Log_Total_Assets:\n")
vif_values_with_assets <- vif(regression_results_with_assets)
print(vif_values_with_assets)

# Compute tolerance values for multicollinearity
tolerance_values_with_assets <- 1 / vif_values_with_assets
cat("\nTolerance Values (TOL = 1/VIF) for Model with Log_Total_Assets:\n")
print(tolerance_values_with_assets)

# Check for heteroscedasticity using Breusch-Pagan test for the model with Log_Total_Assets
cat("\nBreusch-Pagan Test for Heteroskedasticity (with Log_Total_Assets):\n")
bp_test_with_assets <- bptest(regression_results_with_assets)
print(bp_test_with_assets)

```

11.2 Regression (without total Assets:)
```{r}
# Define the formula for regression without Log_Total_Assets
regression_formula_without_assets <- CAR_Event ~ Certification_Dummy + Log_Issued_Amount + Yield +
  Maturity_Years + Log_Market_Value + Election_Dummy

# Run regression without Log_Total_Assets
regression_results_without_assets <- lm(regression_formula_without_assets, data = CAR_regression_data)

# Print the regression results
cat("\nRegression Results without Log_Total_Assets:\n")
print(summary(regression_results_without_assets))

# Check for multicollinearity (VIF) for the regression without Log_Total_Assets
cat("\nVIF Values for Model without Log_Total_Assets:\n")
vif_values_without_assets <- vif(regression_results_without_assets)
print(vif_values_without_assets)

# Compute tolerance values for multicollinearity
tolerance_values_without_assets <- 1 / vif_values_without_assets
cat("\nTolerance Values (TOL = 1/VIF) for Model without Log_Total_Assets:\n")
print(tolerance_values_without_assets)

# Check for heteroscedasticity using Breusch-Pagan test for the model without Log_Total_Assets
cat("\nBreusch-Pagan Test for Heteroskedasticity (without Log_Total_Assets):\n")
bp_test_without_assets <- bptest(regression_results_without_assets)
print(bp_test_without_assets)

# If heteroscedasticity is detected, apply robust standard errors
if (bp_test_without_assets$p.value < 0.05) {
  cat("\nHeteroscedasticity detected! Applying robust standard errors...\n")
  
  # Compute robust standard errors if heteroscedasticity is detected
  robust_se_without_assets <- vcovHC(regression_results_without_assets, type = "HC3")
  robust_summary_without_assets <- coeftest(regression_results_without_assets, vcov = robust_se_without_assets)
  
  # Create a data frame for regression results with robust errors
  Regression_output <- data.frame(
    Term = rownames(robust_summary_without_assets),
    Estimate = robust_summary_without_assets[, 1],
    Std_Error = robust_summary_without_assets[, 2],
    t_value = robust_summary_without_assets[, 3],
    p_value = robust_summary_without_assets[, 4]
  )
  
  # Add significance markers
  Regression_output <- Regression_output %>%
    mutate(Significance = case_when(
      p_value < 0.01 ~ "***",  # 1% significance
      p_value < 0.05 ~ "**",   # 5% significance
      p_value < 0.10 ~ "*",    # 10% significance
      TRUE ~ "n.s."            # Not significant
    ))
  
  cat("\nRegression Results with Robust Standard Errors (without Log_Total_Assets):\n")
  print(Regression_output)
} else {
  cat("\nNo heteroscedasticity detected. Proceeding with regular standard errors (no need for robust standard errors).\n")
}

```

11.3 Mean and Standard Deviations for Regression Variables:

```{r}
sd_yield_manual <- sqrt(var(CAR_regression_data$Yield, na.rm = TRUE))

# Compute means and standard deviations for the regression variables
regression_summary <- CAR_regression_data %>%
  summarise(
    `Certified (1/0)` = round(mean(Certification_Dummy, na.rm = TRUE), 3),
    `Certified (1/0) SD` = paste0("(", round(sd(Certification_Dummy, na.rm = TRUE), 3), ")"),
    
    `Issued Amount (Log)` = round(mean(Log_Issued_Amount, na.rm = TRUE), 3),
    `Issued Amount (Log) SD` = paste0("(", round(sd(Log_Issued_Amount, na.rm = TRUE), 3), ")"),
    
    `Yield` = round(mean(Yield, na.rm = TRUE), 3),
    `Yield SD` = paste0("(", round(sd_yield_manual, 3), ")"),
    
    `Maturity (Years)` = round(mean(Maturity_Years, na.rm = TRUE), 3),
    `Maturity (Years) SD` = paste0("(", round(sd(Maturity_Years, na.rm = TRUE), 3), ")"),
    
    `Log Market Value` = round(mean(Log_Market_Value, na.rm = TRUE), 3),
    `Log Market Value SD` = paste0("(", round(sd(Log_Market_Value, na.rm = TRUE), 3), ")"),
    
    `Log Total Assets` = round(mean(Log_Total_Assets, na.rm = TRUE), 3),
    `Log Total Assets SD` = paste0("(", round(sd(Log_Total_Assets, na.rm = TRUE), 3), ")"),
    
    `Election Dummy (1/0)` = round(mean(Election_Dummy, na.rm = TRUE), 3),
    `Election Dummy (1/0) SD` = paste0("(", round(sd(Election_Dummy, na.rm = TRUE), 3), ")")
  )


regression_summary_formatted <- as.data.frame(t(regression_summary))

cat("\nSummary of Regression Variables (Means and Standard Deviations):\n")
print(regression_summary_formatted)
```

